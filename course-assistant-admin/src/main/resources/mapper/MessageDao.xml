<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.zrn.assistant.dao.MessageDao">

    <resultMap type="com.zrn.assistant.entity.MessageEntity" id="messageMap">
        <result property="id" column="id"/>
        <result property="title" column="title"/>
        <result property="content" column="content"/>
        <result property="sendUserId" column="send_user_id"/>
        <result property="courseId" column="course_id"/>
        <result property="readCount" column="read_count"/>
        <result property="createTime" column="create_time"/>
        <result property="modifyTime" column="modify_time"/>
        <result property="deleted" column="deleted"/>
    </resultMap>

    <select id="messagePage" resultType="com.zrn.assistant.dto.MessageDTO">
        select
            a.*,
            b.name as courseName,
            b.count as receiveCount
        from
            t_message a JOIN t_course b on a.course_id = b.id
        where a.deleted = 0
    </select>

    <select id="userMessage" resultType="com.zrn.assistant.dto.MessageDTO">
        select
            a.id,
            a.readed,
            a.read_time,
            a.create_time,
            b.title,
            b.content,
            c.name as courseName,
            d.real_name as sendUserName
        FROM t_message_user a
                 left join t_message b on a.message_id = b.id
                 left join t_course c on c.id =b.course_id
                 left join t_user d on b.send_user_id = d.id
        where a.deleted = 0
    </select>

</mapper>