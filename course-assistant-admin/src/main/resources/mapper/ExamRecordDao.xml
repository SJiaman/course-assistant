<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.zrn.assistant.dao.ExamRecordDao">

    <resultMap type="com.zrn.assistant.entity.ExamRecordEntity" id="examRecordMap">
        <result property="id" column="id"/>
        <result property="examId" column="exam_id"/>
        <result property="studentId" column="student_id"/>
        <result property="score" column="score"/>
        <result property="correctCount" column="correct_count"/>
        <result property="doTime" column="do_time"/>
        <result property="status" column="status"/>
        <result property="createTime" column="create_time"/>
        <result property="modifyTime" column="modify_time"/>
        <result property="deleted" column="deleted"/>
    </resultMap>

    <select id="getExamRecordList" resultType="com.zrn.assistant.dto.ExamRecordDTO">
        select
            b.id,
            a.exam_name,
            a.course_id,
            a.score as totalScore,
            a.duration,
            a.question_count,
            b.student_id,
            b.score as userScore,
            b.correct_count,
            b.do_time as doTime,
            b.create_time,
            b.status
        from
            t_exam a
                left join
            t_exam_record b on a.id = b.exam_id
        <if test="ew.emptyOfWhere == false">
            ${ew.customSqlSegment}
        </if>
    </select>

    <select id="getExamRecordListCount" resultType="com.zrn.assistant.dto.RecordCountDTO" parameterType="list">
        select DATE_FORMAT(create_time,'%Y-%m-%d') AS day,count(1) as recordCount
        from t_exam_record a
        where deleted = 0 and exam_id in
        <foreach item="item" collection="ids" separator="," open="(" close=")" index="">
            #{item}
        </foreach>
        GROUP BY day
        order by day
        limit 10
    </select>

</mapper>